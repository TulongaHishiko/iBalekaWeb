@model IEnumerable<iBalekaWeb.Models.Event>
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@if (SignInManager.IsSignedIn(User))
{
    <div class="row">
        <div class="col s12">
            <div class="card blue-grey darken-1">
                <div class="card-content white-text">
                    <span id="eventTiteText" class="card-title">@UserManager.GetUserName(User)</span>
                    <span class="card-title right">Events</span>
                    <div class="row">
                        <div class="col s6">
                            Number of Events:
                        </div>
                        <div class="col s6">
                            Upcoming Event:<br />
                            Time until next event starts:
                        </div>
                    </div>
                </div>
                <div class="card-action">
                    <div class="row">
                        <div class="col s12">
                            <ul class="red tabs">
                                <li class="tab col s4 red-text"><a href="#activeEvents">Active Events</a></li>
                                <li class="tab col s4 red-text"><a class="active" href="#openEvents">Open Events</a></li>
                                <li class="tab col s4 red-text"><a href="#closedEvents">Closed Events</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    
    <div id="activeEvents">
    
        <div class="row">
            <ul class="collection" id="activeEventList">
                @if (Model.Count() > 0)
                {
                @if ((ViewBag.ActiveEvents as IEnumerable<Event>).Count() > 0)
                    {
                        foreach (Event evnt in ViewBag.ActiveEvents)
                        {
                <li class="collection-item">
                    <div>
                        @Html.ActionLink(evnt.Title + "-" + evnt.Location, "EventDetails", new { id = evnt.EventId })
                        <a class="secondary-content" href=@Url.Action("DeleteEvent", "Event", new { id = evnt.EventId })>
                            <i class="material-icons">
                                delete
                            </i>
                        </a>
                    </div>
                </li>
                        }
                    }
                    else
                    {
                <li class="collection-item" style="text-align:center;"><h5>There are no Active Events</h5></li>
                    }
                }
                else
                {
                <li class="collection-item" style="text-align:center;"><h5>There are no Events to display</h5></li>
                }
            </ul>

        </div>
    </div>
    <div id="openEvents">
        <div class="row">
            <div class="col s12 center">
                <form asp-controller="Event" asp-action="SearchEvent" method="get">
                    <div class="input-field col s12 center">
                        <input id="searchEvent" type="text" class="validate" name="SearchLocation" required>
                        <label for="searchEvents">Search Event By Location</label>
                        <input type="submit" value="Search" />


                    </div>

                </form>

            </div>
        </div>
        <div class="row">
            <ul class="collection" id="openEventList">
                @if (Model.Count() > 0)
                {
                    if ((ViewBag.OpenEvents as IEnumerable<Event>).Count() > 0)
                    {
                        foreach (Event evnt in ViewBag.OpenEvents)
                        {

                <li class="collection-item">
                    <div>
                        @Html.ActionLink(evnt.Title + "-" + evnt.Location, "EventDetails", new { id = evnt.EventId })
                        <a class="secondary-content" href=@Url.Action("DeleteEvent", "Event", new { id = evnt.EventId })>
                            <i class="material-icons">
                                delete
                            </i>
                        </a>
                    </div>
                </li>
                        }
                    }
                    else
                    {
                <li class="collection-item" style="text-align:center;"><h5>There are no Open Events</h5></li>
                    }
                }
                else
                {
                <li class="mdl-typography--headline" style="text-align:center;"><h5>There are no Events to display</h5></li>
                }


            </ul>

        </div>
    </div>
    <div id="closedEvents">
        <div class="row">
            <ul class="collection" id="activeEventList">
                @if (Model.Count() > 0)
                {
                    if ((ViewBag.ClosedEvents as IEnumerable<Event>).Count() > 0)
                    {
                        foreach (Event evnt in ViewBag.ClosedEvents)
                        {
                            <li class="collection-item">
                                <div>
                                    @Html.ActionLink(evnt.Title + "-" + evnt.Location, "EventDetails", new { id = evnt.EventId })
                                    <a class="secondary-content" href=@Url.Action("DeleteEvent", "Event", new { id = evnt.EventId })>
                                        <i class="material-icons">
                                            delete
                                        </i>
                                    </a>
                                </div>
                            </li>
                        }
                    }
                    else
                    {
                        <li class="collection-item" style="text-align:center;"><h5>There are no Closed Events</h5></li>
                    }
                }
                else
                {
                    <li class="collection-item" style="text-align:center;"><h5>There are no Events to display</h5></li>
                }


            </ul>

        </div>
    </div>

        <div class="row">
            <div class="col pull-s6 right">
                <a asp-action="CreateEvent" asp-controller="Event" class="btn waves-effect waves-light btn-large red accent-3">
                    Create Event
                    <i class="material-icons right">send</i>
                </a>
            </div>

            <div class="col push-s6 left">
                <a asp-action="Map" asp-controller="Map" class="btn waves-effect waves-light btn-large red accent-3">
                    Create Route
                    <i class="material-icons right">send</i>
                </a>
            </div>
        </div>
}
<script src="/lib/jquery/dist/jquery.js"></script>
<script>
    $(document).ready(function () {

        var source = '@(ViewBag.SourcePageEvent)';
        if (source == "Edit") {
            var $toastContent = $('<span>Event was successfully Updated...</span>');
            Materialize.toast($toastContent, 5000);
            source = null;
        }
        else if (source == "Add") {
            var $toastContent = $('<span>Event was successfully Added...</span>');
            Materialize.toast($toastContent, 5000);
            source = null;
        }
        else if (source == "Delete") {
            var $toastContent = $('<span>Event was successfully Deleted...</span>');
            Materialize.toast($toastContent, 5000);
            source = null;
        }
    });
</script>
