function initAutocomplete(){autocomplete=new google.maps.places.Autocomplete(document.getElementById("autocomplete"),{types:["geocode"]});autocomplete.addListener("place_changed",fillInAddress)}function initMap(){map=new google.maps.Map(document.getElementById("map"),{zoom:15,center:{lat:-33.9913503,lng:25.6568993},zoomControl:!0,streetViewControl:!1,scaleControl:!0});getLocation();editButton=document.getElementById("editButton");statsPanel=document.getElementById("statsPanel");settingsPanel=document.getElementById("settingsPanel");settingsPanel.index=1;map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(editButton);map.controls[google.maps.ControlPosition.RIGHT_TOP].push(statsPanel);map.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(settingsPanel);settingsPanel.style.display="none";statsPanel.style.display="none";map.addListener("click",addCheckPoint)}function toastMessage(){settingsPanel.style.display=="none"?Materialize.toast("Map Click Enabled",3e3):Materialize.toast("Map Click Suspended",3e3)}function settingsPanelToggle(){settingsPanel.style.display=="none"?openSettingsPanel():closeSettingsPanel()}function openSettingsPanel(){google.maps.event.clearListeners(map,"click");settingsPanel.style.display="block";toastMessage()}function closeSettingsPanel(){map.addListener("click",addCheckPoint);settingsPanel.style.display="none";toastMessage()}function updateRouteTitle(){routeTitleText=document.getElementById("routeTitle");routeTitleStat.innerHTML=routeTitleText.value}function statsPanelToggle(){statsPanel.style.display=statsPanel.style.display=="none"?"block":"none"}function closeStatsPanel(){statsPanel.style.display="none"}function getLocation(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(showPosition)}function showPosition(n){map.setCenter(new google.maps.LatLng(n.coords.latitude,n.coords.longitude))}function addCheckPoint(n){routePoints.push(n.latLng);routePath===undefined||routePath.setMap(null);routePath=getRoutePath();routePath.setMap(map);var t=getMarkerUniqueId(n.latLng.lat(),n.latLng.lng());marker=new google.maps.Marker({position:n.latLng,draggable:!0,title:"Checkpoint "+routePoints.length,id:routePoints.length,map:map});markers[t]=marker;markersOrders.push(marker);dragMarkerEvent(marker);updateToolboxStats();bindMarkerPolylineEvents(marker);routePoints[1]==null&&(statsPanel.style.display="block")}function dragMarkerEvent(n){google.maps.event.addListener(n,"dragstart",function(){prevLocation=n.getPosition();google.maps.event.addListener(n,"dragend",function(t){for(var r,u,i=0;i<routePoints.length;i++)if(routePoints[i]===prevLocation){routePoints[i]=t.latLng;break}for(r in markers)if(markers.hasOwnProperty(r)&&r===getMarkerUniqueId(prevLocation.lat(),prevLocation.lng())){u=getMarkerUniqueId(t.latLng.lat(),t.latLng.lng());markers[u]=n;delete markers[r];break}resetPolyline()})})}function getRoutePath(){return new google.maps.Polyline({path:routePoints,strokeColor:"#000000",strokeOpacity:1,strokeWeight:3,geodesic:!0})}function bindMarkerPolylineEvents(n){google.maps.event.addListener(n,"rightclick",function(n){var t=getMarkerUniqueId(n.latLng.lat(),n.latLng.lng()),i=markers[t];removeCheckpoint(i,t);removePolyline(n);resetPolyline();refreshMarkers()})}function removeCheckpoint(n,t){n.setMap(null);delete markers[t];for(var i=0;i<markersOrders.length;i++)if(markersOrders[i]===n){markersOrders.splice(i,1);break}updateToolboxStats()}function removePolyline(n){for(var t=0;t<routePoints.length;t++)if(routePoints[t]===n.latLng){routePoints.splice(t,1);break}}function resetPolyline(){routePath.setMap(null);routePath=getRoutePath();routePath.setMap(map)}function refreshMarkers(){for(var t,i,n=0;n<markersOrders.length;n++)markersOrders[n].setTitle("Checkpoint "+(n+1));for(t=0;t<markersOrders.length;t++)for(i in markers)if(markersOrders[t].getPosition()===markers[i].getPosition()){markers[i].setTitle("Checkpoint "+(t+1));break}}function createToolbox(){}function saveRoute(){var n;routePoints[2]!=null?routeTitleText.value==""?$("#routeTitleModal").openModal():(n=routeTitleText.value,saveRouteAJAX(n)):Materialize.toast("Not Enough Checkpoints to Save Route",3e3)}function saveRouteModal(){var n=document.getElementById("routeTitleTextModal");routeTitleText.value=n.value;updateRouteTitle();saveRouteAJAX(n.value)}function saveRouteAJAX(n){var t,i;$("#btnSaveRoute").prop("disabled",!0);t=$("<span>Saving Route...<\/span>");Materialize.toast(t,9e3);i=location.origin+"/map/AddRoute";$.ajax({method:"POST",url:i,contentType:"application/json;charset=utf-8",processData:!1,data:createObject(n),success:function(){window.location.href=location.origin+"/map/SavedRoutes"},error:function(n,t,i){alert("Error: "+t+" "+i+" "+n)}})}function createObject(n){for(var i,u,r={Title:n,Checkpoints:[],TotalDistance:totalDistance},t=0;t<markersOrders.length;t++)i=markersOrders[t].getPosition(),u={Latitude:i.lat(),Longitude:i.lng()},r.Checkpoints.push(u);return JSON.stringify(r)}function clearRoute(){for(var n in markers)markers[n].setMap(null);markersOrders=[];markers=[];routePoints=[];resetPolyline();updateToolboxStats()}function updateToolboxStats(){nrCheckpointsText.innerHTML="Nr of Checkpoints: "+getCheckpointLength();totalDistanceText.innerHTML="Total Distance "+getTotalDistance()}function getTotalDistance(){return(refreshDistance(),totalDistance>999)?totalDistance/1e3+"km":totalDistance+"m"}function calculateDistance(){var n,t,i;return n=distanceCoords[0],t=distanceCoords[1],i=google.maps.geometry.spherical.computeDistanceBetween(n,t),Math.round(i)}function refreshDistance(){distanceCoords=[];totalDistance=0;for(var n=0;n<markersOrders.length;n++)loadDistanceCoords(markersOrders[n]),n>=1&&(totalDistance+=calculateDistance(distanceCoords))}function loadDistanceCoords(n){distanceCoords.push(n.getPosition());distanceCoords.length>2&&distanceCoords.splice(0,1)}function getCheckpointLength(){return markersOrders.length}function loadRoute(n){routeTitleText.value=n.title;updateRouteTitle();map.setCenter(new google.maps.LatLng(n.checkpoints[0].latitude,n.checkpoints[0].longitude));for(var t=0;t<n.checkpoints.length;t++)loadCheckpoints(n.checkpoints[t]);loadedRoute=n;statsPanel.style.display="block"}function loadCheckpoints(n){var t=new google.maps.LatLng(n.latitude,n.longitude),i;routePoints.push(t);routePath===undefined||routePath.setMap(null);routePath=getRoutePath();routePath.setMap(map);i=getMarkerUniqueId(n.latitude,n.longitude);marker=new google.maps.Marker({position:t,draggable:!0,title:"Checkpoint "+routePoints.length,id:routePoints.length,map:map});markers[i]=marker;markersOrders.push(marker);dragMarkerEvent(marker);updateToolboxStats();bindMarkerPolylineEvents(marker)}function updateRouteModal(){var n=document.getElementById("routeTitleTextModal");routeTitleText.value=n.value;updateRouteTitle();updateRouteAJAX()}function updateRoute(){if(routePoints[2]!=null)if(routeTitleText.value!=""){$("#btnUpdateRoute").prop("disabled",!0);var n=$("<span>Updating Route...<\/span>");Materialize.toast(n,9e3);updateRouteAJAX()}else $("#routeTitleModal").openModal();else Materialize.toast("Not Enough Checkpoints to Save Route",3e3)}function updateRouteAJAX(){var n=location.origin+"/map/Edit";$.ajax({method:"POST",url:n,contentType:"application/json;charset=utf-8",processData:!1,data:createUpdatedObject(),success:function(){window.location.href=location.origin+"/map/SavedRoutes"},error:function(n,t,i){alert("Error: "+t+" "+i+" "+n)}})}function cancelRoute(){var n=location.origin+"/map/SavedRoutes";$.ajax({method:"GET",url:n,processData:!1,success:function(){window.location.href=location.origin+"/map/SavedRoutes"},error:function(n,t,i){alert("Error: "+t+" "+i+" "+n)}})}function createUpdatedObject(){for(var t,r,i={RouteId:loadedRoute.routeId,Title:routeTitleText.value,Checkpoints:[],TotalDistance:totalDistance},n=0;n<markersOrders.length;n++)t=markersOrders[n].getPosition(),r={Latitude:t.lat(),Longitude:t.lng()},i.Checkpoints.push(r);return JSON.stringify(i)}function loadDeletedRouteId(n){n!==null&&(loadedRouteId=n)}function deleteRoute(){var n=location.origin+"/map/Delete";$.ajax({method:"POST",url:n,contentType:"application/json;charset=utf-8",processData:!1,data:JSON.stringify(loadedRouteId),success:function(){window.location.href=location.origin+"/map/SavedRoutes"},error:function(n,t,i){console.log("Error: "+t.toString()+" "+i.toString()+" "+n.toString())}})}var map,editButton,statsPanel,settingsPanel,routeTitleText,routeTitleStat,loadedRoute,loadedRouteId;$(".button-collapse").sideNav();$(document).ready(function(){$("select").material_select()});$(function(){Materialize.updateTextFields()});routeTitleText=document.getElementById("routeTitle");routeTitleStat=document.getElementById("routeTitleStat");var routePath,marker,prevLocation,markers=[],markersOrders=[],routePoints=[],nrCheckpointsText=document.getElementById("nrCheckpoints"),totalDistanceText=document.getElementById("totalDistance"),totalDistance=0,distanceCoords=[],getMarkerUniqueId=function(n,t){return n+"_"+t};